# Configuration for joplin setup

# Name of the big-bear-joplin application
# Service definitions for the big-bear-joplin application
services:
  # Configuration for the PostgreSQL database service used by Joplin
  big-bear-joplin-db:
    container_name: big-bear-joplin-db # Name of the database container.
    image: postgres:14.2 # Docker image for PostgreSQL, specifying version.
    volumes:
      - ${APP_DATA_DIR}/postgresql/data:/var/lib/postgresql/data # Maps data directory to host for persistence.
    restart: unless-stopped # Restart policy similar to the Joplin server container.
    environment:
      - POSTGRES_PASSWORD=27a1d42a-a15d-43dd-903c-2a73538647fe # Database password, matching the Joplin server configuration.
      - POSTGRES_USER=bigbear # Username for the database, intended for CasaOS usage.
      - POSTGRES_DB=joplin # Specifies the database used for storing Joplin data.
    networks:
      - tipi_main_network
    labels:
      runtipi.managed: "true"
  joplin:
    container_name: joplin # The name of the Docker container for easy reference.
    image: joplin/server:3.5.1 # Docker image to use, specifying version.
    restart: unless-stopped # Policy to automatically restart the container unless manually stopped.
    # Environment variables for the Joplin server, configuring database connection and application settings.
    environment:
      - APP_PORT=22300 # Port the Joplin server listens on.
      - APP_BASE_URL=http://localhost:22300 # Base URL for the Joplin server.
      - DB_CLIENT=pg # Specifies the database client (PostgreSQL).
      - POSTGRES_PASSWORD=27a1d42a-a15d-43dd-903c-2a73538647fe # Password for the PostgreSQL database.
      - POSTGRES_USER=bigbear # Username for the PostgreSQL database.
      - POSTGRES_DATABASE=joplin # Database name for Joplin data.
      - POSTGRES_PORT=5432 # Port for connecting to the PostgreSQL database.
      - POSTGRES_HOST=big-bear-joplin-db # Hostname of the PostgreSQL database container.
      - MAX_TIME_DRIFT=0 # Maximum allowed time drift for synchronization.
    # Ports mapping from host to container, for network access to the Joplin server.
    ports:
      - "${APP_PORT}:22300" # Maps port 22300 on the host to port 22300 on the container.
    networks:
      - tipi_main_network
    depends_on:
      - big-bear-joplin-db # Specifies the database service as a dependency for the Joplin server.
    labels:
      runtipi.managed: "true"
networks:
  tipi_main_network:
    external: true
